# Flower Embedding: Тестовое задание по поиску похожих цветов

## Быстрый старт

Для работы с данным проектом используется окружение [UV](https://docs.astral.sh/uv). Более подробную инструкцию по установке можно найти по [ссылке](https://docs.astral.sh/uv/getting-started/installation/installation/).

### Запуск через Jupyter

```shell
# Запуск Jupyter Lab с использованием окружения UV:
uv run --with jupyter jupyter lab
```

### Doker:
```shell
# Сборка Docker-образа:
docker build -t image-search-api .

# Запуск Docker-контейнера:
docker run -p 8000:8000 image-search-api
```
### Запросы на Api:
```shell
# Обновление embedding (для обновления модели):
curl -X 'GET' "http://localhost:8000/upload"

# Отправка изображения для поиска похожих образцов.
# В ответ возвращается JSON с 5 ближайшими изображениями:
curl -X 'POST' "http://localhost:8000/upload" -F 'file=@train_data/test/0754_0.jpg'

```
## О проекте:
В основе решения лежит методика построения embedding на базе классификатора. В частности, используется модель MambaOut, обученная с применением функций потерь [CELoss](https://pytorch.org/docs/stable/generated/torch.nn.CrossEntropyLoss.html) и [CenterLoss](https://github.com/KaiyangZhou/pytorch-center-loss). Последняя помогает увеличить расстояние между классами, что обеспечивает компактное группирование похожих объектов. Для оптимизации процесса обучения применяется современный [Adan-SF](https://github.com/neosr-project/adan_schedule_free) (SOTA) оптимизатор, позволяющий проводить обучение без использования планировщика (scheduler).
## Сложности и нюансы реализации:
- **Ограниченные временные ресурсы**: Из-за сжатых сроков не удалось провести предварительное обучение embedding модели. Пришлось параллельно изучать актуальные исследования в этой области и тестировать различные концепции. Решил, я это быстрым ресёрчем и использованием вторичного кода из своих прошлых проектов.
- **Проблемы с обучением модели**: В процессе выбора метода обучения и построения embedding возникали ошибки, что приводило к необходимости многократного перезапуска процесса обучения. Решения небыло как такового, просто отказался от некоторых аугментаций в пользу ускорения схожденния.
